(function(){CKEDITOR.plugins.add("pasteimage",{lang:"en,zh,zh-cn",requires:"uploadwidget",onLoad:function(){CKEDITOR.addCss(".cke_upload_uploading img{"+"opacity: 0.3"+"}")},init:function(editor){CKEDITOR.scriptLoader.load(CKEDITOR.getUrl("plugins/pasteimage/filesize.js"));if(!CKEDITOR.plugins.clipboard.isFileApiSupported){return}var fileTools=CKEDITOR.fileTools,uploadUrl=fileTools.getUploadUrl(editor.config,"image")||"";if(!uploadUrl){return}fileTools.addUploadWidget(editor,"pasteimage",{supportedTypes:/image\/(jpeg|png|gif|bmp)/,uploadUrl:uploadUrl,fileToElement:function(){var img=new CKEDITOR.dom.element("img");img.setAttribute("src",loadingImage);return img},parts:{img:"img"},onUploading:function(upload){this.parts.img.setAttribute("src",upload.data)},onUploaded:function(upload){var $img=this.parts.img.$;this.replaceWith('<img src="'+upload.url+'" '+'">')}});editor.on("paste",function(evt){if(!evt.data.dataValue.match(/<img[\s\S]+data:/i)){return}var data=evt.data,tempDoc=document.implementation.createHTMLDocument(""),temp=new CKEDITOR.dom.element(tempDoc.body),imgs,img,i;temp.data("cke-editable",1);temp.appendHtml(data.dataValue);imgs=temp.find("img");for(i=0;i<imgs.count();i++){img=imgs.getItem(i);var isDataInSrc=img.getAttribute("src")&&img.getAttribute("src").substring(0,5)=="data:",isRealObject=img.data("cke-realelement")===null;if(isDataInSrc&&isRealObject&&!img.data("cke-upload-id")&&!img.isReadOnly(1)){var loader=editor.uploadRepository.create(img.getAttribute("src"));loader.upload(uploadUrl);fileTools.markElement(img,"pasteimage",loader.id);fileTools.bindNotifications(editor,loader)}}data.dataValue=temp.getHtml()});editor.on("fileUploadRequest",function(evt){var lang=editor.lang.pasteimage;var fileLoader=evt.data.fileLoader,fileSize=editor.config.fileSingleSizeLimit||10;var fileByteSize=fileSize*1024*1024;if(fileLoader.file.size>fileByteSize){alert(lang.single_file_max_size_tip+filesize(fileByteSize));evt.cancel()}evt.data.requestData.uploadMode="paste"})}});var loadingImage=""})();function echo(stringA,stringB){var hello="你好";alert("hello world")};